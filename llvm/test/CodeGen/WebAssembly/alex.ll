; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mattr=+alex128 < %s | FileCheck %s --check-prefix=I128
; RUN: llc -mattr=+alex-carry,+alex-overflow,+alex-misc < %s | FileCheck %s --check-prefix=CARRY

target triple = "wasm32-unknown-unknown"

define i128 @add_i128(i128 %a, i128 %b) {
; I128-LABEL:  add_i128:
; I128:        i64.add128
; CARRY-LABEL: add_i128:
; CARRY:       i64.add_overflow_u
; CARRY:       i64.add_with_carry_u
  %c = add i128 %a, %b
  ret i128 %c
}

define i128 @sub_i128(i128 %a, i128 %b) {
; I128-LABEL:  sub_i128:
; I128:        i64.sub128
; CARRY-LABEL: sub_i128:
; CARRY:       i64.sub_overflow_u
; CARRY:       i64.sub_with_carry_u
  %c = sub i128 %a, %b
  ret i128 %c
}

define i128 @mul_i128(i128 %a, i128 %b) {
; I128-LABEL:  mul_i128:
; I128:        i64.mul128
; CARRY-LABEL: mul_i128:
; CARRY:       i64.mul_wide_u
  %c = mul i128 %a, %b
  ret i128 %c
}

declare {i32, i1} @llvm.sadd.with.overflow.i32(i32 %a, i32 %b)
declare {i64, i1} @llvm.sadd.with.overflow.i64(i64 %a, i64 %b)
declare {i32, i1} @llvm.uadd.with.overflow.i32(i32 %a, i32 %b)
declare {i64, i1} @llvm.uadd.with.overflow.i64(i64 %a, i64 %b)
declare {i32, i1} @llvm.ssub.with.overflow.i32(i32 %a, i32 %b)
declare {i64, i1} @llvm.ssub.with.overflow.i64(i64 %a, i64 %b)
declare {i32, i1} @llvm.usub.with.overflow.i32(i32 %a, i32 %b)
declare {i64, i1} @llvm.usub.with.overflow.i64(i64 %a, i64 %b)

define { i32, i1 } @i32_add_overflow_s(i32 %a, i32 %b) {
; CARRY-LABEL: i32_add_overflow_s:
; CARRY:       i32.add_overflow_s
  %r = call { i32, i1 } @llvm.sadd.with.overflow.i32(i32 %a, i32 %b)
  ret { i32, i1 } %r
}

define { i32, i1 } @i32_add_overflow_u(i32 %a, i32 %b) {
; CARRY-LABEL: i32_add_overflow_u:
; CARRY:       i32.add_overflow_u
  %r = call { i32, i1 } @llvm.uadd.with.overflow.i32(i32 %a, i32 %b)
  ret { i32, i1 } %r
}

define { i64, i1 } @i64_add_overflow_s(i64 %a, i64 %b) {
; CARRY-LABEL: i64_add_overflow_s:
; CARRY:       i64.add_overflow_s
  %r = call { i64, i1 } @llvm.sadd.with.overflow.i64(i64 %a, i64 %b)
  ret { i64, i1 } %r
}

define { i64, i1 } @i64_add_overflow_u(i64 %a, i64 %b) {
; CARRY-LABEL: i64_add_overflow_u:
; CARRY:       i64.add_overflow_u
  %r = call { i64, i1 } @llvm.uadd.with.overflow.i64(i64 %a, i64 %b)
  ret { i64, i1 } %r
}

define { i32, i1 } @i32_sub_overflow_s(i32 %a, i32 %b) {
; CARRY-LABEL: i32_sub_overflow_s:
; CARRY:       i32.sub_overflow_s
  %r = call { i32, i1 } @llvm.ssub.with.overflow.i32(i32 %a, i32 %b)
  ret { i32, i1 } %r
}

define { i32, i1 } @i32_sub_overflow_u(i32 %a, i32 %b) {
; CARRY-LABEL: i32_sub_overflow_u:
; CARRY:       i32.sub_overflow_u
  %r = call { i32, i1 } @llvm.usub.with.overflow.i32(i32 %a, i32 %b)
  ret { i32, i1 } %r
}

define { i64, i1 } @i64_sub_overflow_s(i64 %a, i64 %b) {
; CARRY-LABEL: i64_sub_overflow_s:
; CARRY:       i64.sub_overflow_s
  %r = call { i64, i1 } @llvm.ssub.with.overflow.i64(i64 %a, i64 %b)
  ret { i64, i1 } %r
}

define { i64, i1 } @i64_sub_overflow_u(i64 %a, i64 %b) {
; CARRY-LABEL: i64_sub_overflow_u:
; CARRY:       i64.sub_overflow_u
  %r = call { i64, i1 } @llvm.usub.with.overflow.i64(i64 %a, i64 %b)
  ret { i64, i1 } %r
}

define i128 @i64_mul_wide_s(i64 %a, i64 %b) {
; CARRY-LABEL: i64_mul_wide_s:
; CARRY:       i64.mul_wide_s
  %a128 = sext i64 %a to i128
  %b128 = sext i64 %b to i128
  %c = mul i128 %a128, %b128
  ret i128 %c
}

define i128 @i64_mul_wide_u(i64 %a, i64 %b) {
; CARRY-LABEL: i64_mul_wide_u:
; CARRY:       i64.mul_wide_u
  %a128 = zext i64 %a to i128
  %b128 = zext i64 %b to i128
  %c = mul i128 %a128, %b128
  ret i128 %c
}
